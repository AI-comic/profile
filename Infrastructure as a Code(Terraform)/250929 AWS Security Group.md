# AWS Security Group (보안 그룹)

AWS Security Group은 AWS 클라우드에서 리소스에 대한 **가상 방화벽** 역할을 수행하는 핵심 보안 기능입니다.  
VPC 내 리소스의 **인바운드(Inbound) 및 아웃바운드(Outbound) 트래픽**을 제어하여 불필요한 접근을 차단하고 보안을 강화합니다.  
단순히 포트 차단에 그치지 않고, **IP 주소·포트·프로토콜 수준**에서 접근을 관리할 수 있습니다.  

---

## 🧭 학습 목표
- 보안 그룹의 기본 개념과 방화벽으로서의 역할 이해  
- 인바운드 및 아웃바운드 규칙의 동작 방식 파악  
- 웹 서버, 데이터베이스 서버 등 리소스별 보안 그룹 모범 사례 학습  
- Terraform을 활용한 보안 그룹 관리 방법 이해  

---

## 🔒 보안 그룹의 작동 방식

- **OSI 7 계층 기준 제어**  
  - **3계층(네트워크 계층)**: IP 주소 기반 필터링  
  - **4계층(전송 계층)**: 포트 기반 필터링  

- **허용 기반 모델 (Allowlist)**  
  - 기본적으로 모든 트래픽이 차단되며, **명시적으로 허용된 규칙만** 통과 가능  

- **상태 저장(Stateful) 특성**  
  - 인바운드에서 허용된 요청은 아웃바운드 규칙과 관계없이 응답이 자동 허용됨  
  - 예: 인스턴스가 외부 서버의 80번 포트로 요청을 보냈다면, 해당 응답은 별도 규칙 없이 허용  

---

## ⚙️ 보안 그룹 규칙

- **인바운드(Inbound)**: 외부에서 내부 리소스로 들어오는 트래픽 제어  
- **아웃바운드(Outbound)**: 내부 리소스에서 외부로 나가는 트래픽 제어  
- 규칙 작성 시 고려사항:  
  - **소스 IP는 최소 범위로 제한** (예: `0.0.0.0/0`은 꼭 필요한 경우에만 사용)  
  - **사용하지 않는 포트는 열지 않기**  
  - **CIDR 최소화** 및 불필요한 Any 설정 방지 (`Any IP`, `Any Port`, `Any Protocol`)  
  - 다른 보안 그룹 ID 참조 시, IP 변경에도 유연하게 대응 가능  

---

## 📌 리소스별 보안 그룹 설정 예시

### 1. 웹 서버(Web Server)
- **인바운드**  
  - HTTP(80), HTTPS(443) 트래픽 허용 (`0.0.0.0/0`)  
  - 관리 접근(SSH 22번, RDP 3389번)은 특정 관리자 IP만 허용  
- **아웃바운드**  
  - 일반적으로 모든 트래픽 허용  
  - 필요 시 특정 서비스 또는 IP만 제한적으로 허용  

---

### 2. 데이터베이스 서버(Database Server)
- **인바운드**  
  - 웹/애플리케이션 서버의 **보안 그룹 ID**에서 오는 트래픽만 DB 포트(MySQL 3306, PostgreSQL 5432 등) 허용  
  - 외부 인터넷에서 직접 접근 불가 → 보안 강화  
- **아웃바운드**  
  - 일반적으로 필요하지 않음 → 모든 트래픽 차단 권장  
  - 필요한 경우 내부 리소스 접근만 허용  

---

### 3. 고도 보안 환경
- **인바운드**: 특정 관리용 IP만 허용  
- **아웃바운드**: 필요한 외부 서비스만 허용, 나머지는 전부 차단  

---

### 4. 개발 환경
- **인바운드**: 개발자의 다양한 접근을 위해 상대적으로 개방적 설정  
- **아웃바운드**: 개발 및 테스트를 위해 여러 외부 서비스 접근 허용  

---

## 🛠 Terraform을 활용한 보안 그룹 관리

보안 그룹은 수동으로 설정할 수 있지만, **Terraform과 같은 IaC(Infrastructure as Code) 도구**를 사용하면 관리가 훨씬 효율적입니다.  
`aws_security_group` 리소스를 활용하면 인바운드/아웃바운드 규칙을 코드로 정의하여 **일관성**과 **재현성**을 확보할 수 있습니다.  

```hcl
resource "aws_security_group" "web_sg" {
  name        = "web_sg"
  description = "Security group for web server"
  vpc_id      = var.vpc_id

  ingress {
    description = "Allow HTTP"
    from_port   = 80
    to_port     = 80
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  ingress {
    description = "Allow HTTPS"
    from_port   = 443
    to_port     = 443
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }
}
