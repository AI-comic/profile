### Amazon VPC(Virtual Private Cloud)란?

- AWS가 제공하는 **가상 네트워크(Virtual Network) 서비스**
- 하나의 VPC는 **AWS 리전(Region) 단위**로 생성되며, 다른 리전과는 분리되어 동작
- 네트워크 주소 공간은 CIDR(Classless Inter-Domain Routing) 블록을 기반으로 설정
  - 예: `10.0.0.0/16` → 최대 65,536개 IP 사용 가능
  - [CIDR 계산기](https://www.ipaddressguide.com/cidr)를 활용하면 편리하게 서브넷 크기를 나눌 수 있음
- VPC와 가용 영역(AZ)
  - VPC는 단일 리전에 속하지만, 여러 **가용 영역(Availability Zone, AZ)** 에 걸쳐 리소스를 배치할 수 있다. 이는 애플리케이션의 고가용성과 내결함성을 확보하는 데 필수적이다.
---

### 서브넷(Subnet)

- VPC의 주소 공간을 **더 작은 네트워크 단위로 분할**한 것
- 예시:
  - `10.0.0.0/16` → 전체 VPC 주소
  - `10.0.1.0/24` → 256개의 IP 보유한 서브넷
  - `10.0.2.0/20` → 약 4,094개의 IP 보유한 서브넷

- 서브넷 유형
  - **퍼블릭 서브넷**: 외부 인터넷과 직접 통신이 가능한 영역 → 인터넷을 통해 접근해야 하는 웹 서버, Bastion 서버 배치
  - **프라이빗 서브넷**: 외부 인터넷과 직접 연결 불가 → DB 서버, 내부 전용 서버 등 보안이 요구되는 리소스를 배치

---

### 인터넷 게이트웨이(IGW)

- VPC와 외부 인터넷을 연결하는 역할
- 퍼블릭 서브넷의 인스턴스가 인터넷과 통신하려면 반드시 IGW가 필요
- 라우팅 테이블에 `0.0.0.0/0 → IGW` 규칙이 있어야 외부 연결 가능
- IGW 없이는 VPC 내의 어떤 인스턴스도 인터넷과 직접 통신할 수 없음

---

### 라우팅 테이블

- 네트워크 트래픽이 어디로 가야 하는지 목적지를 결정
- 각 서브넷은 하나의 라우팅 테이블과 연결되어 있으며, 이 규칙에 따라 트래픽을 어디로 보낼지 결정
- 예시 규칙:
  | Destination  | Target | 설명 |
  |--------------|--------|------|
  | 10.0.0.0/16  | local  | 같은 VPC 내 서브넷 간 내부 통신 허용 |
  | 0.0.0.0/0    | igw-xxx| 모든 외부 IP 주소로 향하는 트래픽. 이 규칙의 대상(Target)이 IGW로 설정되면 해당 서브넷은 퍼블릭 서브넷이 됨 |

---

### NAT 게이트웨이(Network Address Translation Gateway)

- 프라이빗 서브넷 인스턴스가 외부 인터넷으로 나가는 통신을 가능하게 해주는 서비스
- NAT 게이트웨이를 통과하는 트래픽은 인스턴스의 **프라이빗 IP 주소** 대신 NAT 게이트웨이에 할당된 **탄력적 IP 주소**로 변환 후 인터넷 통신
- 프라이빗 서브넷의 인스턴스는 NAT 게이트웨이를 거쳐 인터넷에 접속하지만, 외부에서는 이 인스턴스에 직접 접근할 수 없음
  - **인바운드 차단**, **아웃바운드 허용**
  - 보안성 강화 + 소프트웨어 업데이트/외부 API 호출 가능
- NAT 게이트웨이는 시간당 요금이 부과되며, 처리하는 데이터 양에 따라 추가 요금이 발생하므로 사용 시 비용을 고려
  - 요금 참고: [Amazon VPC 요금](https://aws.amazon.com/ko/vpc/pricing/) (프리티어 적용 불가)

---

### 탄력적 IP(Elastic IP)

- 인터넷에서 접근 가능한 **고정된 퍼블릭 IPv4 주소**
- EC2 인스턴스를 중지하거나 재시작해도 IP 주소가 바뀌지 않
- NAT 게이트웨이에 EIP를 연결하면 프라이빗 서브넷의 인스턴스들이 항상 동일한 IP 주소를 통해 인터넷과 통신 가
- 프리티어 제외, 사용 시 소량의 요금 부과
  - 요금 참고: [Amazon EC2 온디맨드 요금](https://aws.amazon.com/ko/ec2/pricing/on-demand/#Elastic_IP_Addresses)

---

### Default VPC vs 사용자 정의 VPC

- **Default VPC**
  - AWS 계정 생성 시 자동 제공
  - 이미 서브넷, 라우팅 테이블, 인터넷 게이트웨이가 세팅되어 있음
  - CIDR 블록: `172.31.0.0/16`

- **사용자 정의 VPC**
  - 사용 목적에 맞게 직접 설계
  - **IaC(Infrastructure as a Code)** 를 통해 인프라를 관리할 때 사용하는 것이 표
  - 네트워크 구조(퍼블릭/프라이빗 서브넷, NAT, IGW 등)를 직접 구성해야 함
  - 예: `10.0.0.0/16` CIDR 블록으로 시작해 다양한 서브넷으로 분할 가능

---

### VPC Workflow 예시

1. VPC 생성 (CIDR 지정)
2. 퍼블릭/프라이빗 서브넷 구성
3. 인터넷 게이트웨이 연결
4. 라우팅 테이블 설정
5. 필요 시 NAT 게이트웨이 생성 및 연결
6. 보안 그룹/네트워크 ACL로 접근 제어
